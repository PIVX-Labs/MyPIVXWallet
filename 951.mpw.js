var MPW;(()=>{var t,e,a,n,r={32896:(t,e,a)=>{"use strict";var n=a(17748),r=a(48764);function s(t){return r.Buffer.from(t,"hex")}function o(t){return r.Buffer.from(t).toString("hex")}function i(t){return(0,n.J)((0,n.J)(new Uint8Array(t)))}var c=a(27760),l=a(72697);const d=10**8,u={current:null,main:{name:"mainnet",collateralInSats:1e12,isTestnet:!1,TICKER:"PIV",PUBKEY_PREFIX:["D"],STAKING_PREFIX:"S",PUBKEY_ADDRESS:30,SECRET_KEY:212,BIP44_TYPE:119,BIP44_TYPE_LEDGER:77,PROTOCOL_VERSION:70926,MASTERNODE_PORT:51472,Explorers:[{name:"rockdev",url:"https://explorer.rockdev.org"},{name:"zkBitcoin",url:"https://zkbitcoin.com"},{name:"Duddino",url:"https://explorer.duddino.com"}],Nodes:[{name:"Duddino",url:"https://rpc.duddino.com/mainnet"}],Consensus:{UPGRADE_V6_0:void 0},budgetCycleBlocks:43200,proposalFee:5e9,maxPaymentCycles:6,maxPayment:432e11},testnet:{name:"testnet",collateralInSats:1e12,isTestnet:!0,TICKER:"tPIV",PUBKEY_PREFIX:["x","y"],STAKING_PREFIX:"W",PUBKEY_ADDRESS:139,SECRET_KEY:239,BIP44_TYPE:1,BIP44_TYPE_LEDGER:1,PROTOCOL_VERSION:70926,MASTERNODE_PORT:51474,Explorers:[{name:"rockdev",url:"https://testnet.rockdev.org"}],Nodes:[{name:"Duddino",url:"https://rpc.duddino.com/testnet"}],Consensus:{UPGRADE_V6_0:void 0},budgetCycleBlocks:144,proposalFee:5e9,maxPaymentCycles:20,maxPayment:144e9}};u.current=u.main;var h=a(26269);const y=new(a(17187).EventEmitter);a(25108);var p=a(25108);class m{constructor({id:t,path:e,sats:a,script:n,vin:r=[],vout:s,height:o,status:i,isDelegate:c=!1,isReward:l=!1}={}){this.id=t,this.path=e,this.sats=a,this.script=n,this.vin=r,this.vout=s,this.height=o,this.status=i,this.isDelegate=c,this.isReward=l}equalsUTXO(t){return this.id===t.id&&this.vout===t.vout&&this.status===t.status}}class g{constructor(){this.UTXOs=[],this.subscribeToNetwork()}static CONFIRMED=0;static REMOVED=1;static PENDING=2;getUTXO(t,e){return this.UTXOs.find((a=>a.id===t&&a.vout===e))}async removeWithDelay(t,e){var a;await(a=60*t*1e3,new Promise(((t,e)=>setTimeout(t,a)))),this.removeUTXO(e)}isAlreadyStored({id:t,vout:e,status:a}){return this.UTXOs.some((n=>n.id===t&&n.vout===e&&(!a||n.status===a)))}getUTXOsByState(t){return this.UTXOs.filter((e=>e.status===t))}removeFromState(t,e){const a=this.getUTXOsByState(e);for(const e of a)if(e.id===t.id&&e.vout===t.vout){this.removeUTXO(e);break}}addUTXO({id:t,path:e,sats:a,script:n,vin:r,vout:s,height:o,status:i,isDelegate:c,isReward:l}){const d=new m({id:t,path:e,sats:a,script:n,vin:r,vout:s,height:o,status:i,isDelegate:c,isReward:l});if(this.isAlreadyStored({id:t,vout:s}))this.updateUTXO({id:t,vout:s});else{if(l&&1===r?.length){const t=this.getUTXO(r[0].txid,r[0].vout);t&&this.removeUTXO(t)}this.UTXOs.push(d)}K(!0),N(!0)}updateUTXO({id:t,vout:e}){X&&p.assert(this.isAlreadyStored({id:t,vout:e}),"Debug Mode: updateUTXO must be called with an existing UTXO");const a=this.UTXOs.find((a=>a.id===t&&a.vout==e));a.status===g.PENDING&&(a.status=g.CONFIRMED),K(!0),N(!0)}removeUTXO(t){this.UTXOs=this.UTXOs.filter((e=>!e.equalsUTXO(t)))}autoRemoveUTXO({id:t,vout:e}){for(const a of this.UTXOs)if(a.id===t&&a.vout===e)return a.status=g.REMOVED,void this.removeWithDelay(12,a);p.error("Mempool: Failed to find UTXO "+t+" ("+e+") for auto-removal!")}autoRemoveUTXOs(t){for(const e of t)for(const t of this.UTXOs)if(t.equalsUTXO(e)){t.status=g.REMOVED,this.removeWithDelay(12,t);break}}getConfirmed(){return this.getUTXOsByState(g.CONFIRMED)}getStandardUTXOs(){return this.UTXOs.filter((t=>t.status!==g.REMOVED&&!t.isDelegate))}getDelegatedUTXOs(){return this.UTXOs.filter((t=>t.status!==g.REMOVED&&t.isDelegate))}getBalance(){return this.getStandardUTXOs().filter((t=>!function(t,e){if(e?.collateralTxId){const{collateralTxId:a,outidx:n}=e;return a===t.id&&t.vout===n}return!1}(t))).reduce(((t,e)=>t+e.sats),0)}static isValidUTXO(t){return!t.isReward||null.cachedBlockCount-t.height>100}getDelegatedBalance(){return this.getDelegatedUTXOs().reduce(((t,e)=>t+e.sats),0)}subscribeToNetwork(){y.on("utxo",(async t=>{for(const e of t)this.isAlreadyStored({id:e.txid,vout:e.vout})?this.updateUTXO({id:e.txid,vout:e.vout}):this.addUTXO(await null.getUTXOFullInfo(e))}))}}a(9424),a(2153),a(49840),a(34611),a(2099),a(27578),a(25108);new Map([[25870,"Open the PIVX app on your device"],[25873,"Open the PIVX app on your device"],[57408,"Navigate to the PIVX app on your device"],[27157,"Wrong app! Open the PIVX app on your device"],[27266,"Wrong app! Open the PIVX app on your device"],[27904,"Wrong app! Open the PIVX app on your device"],[27010,"Unlock your Ledger, then try again!"],[27404,"Unlock your Ledger, then try again!"]]);var f=a(25108);const w=new TextEncoder;new TextDecoder;const T=t=>window.crypto.subtle.importKey("raw",w.encode(t),"PBKDF2",!1,["deriveKey"]),E=(t,e,a)=>window.crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:25e4,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,a);class v{constructor(t){this.publicKey=t?.publicKey||"",this.encWif=t?.encWif||"",this.localProposals=t?.localProposals||[],this.contacts=t?.contacts||[],this.name=t?.name||""}publicKey="";encWif="";localProposals=[];contacts=[];name="";getContactBy({name:t,pubkey:e}){if(!t&&!e)throw Error("getContactBy(): At least ONE search parameter MUST be set!");return t?this.contacts.find((e=>e.label===t)):e?this.contacts.find((t=>t.pubkey===e)):null}}async function b(t=O.CONTACT){if(t===O.CONTACT){const t=await at.getInstance(),e=await t.getAccount();if(e?.name){let t="";if(P.isHD()){const e=P.getDerivationPath().split("/").slice(0,4).join("/");t=await P.getMasterKey().getxpub(e)}else t=await P.getMasterKey().getCurrentAddress();const a=await async function(t,e){const a=await at.getInstance(),n=t||await a.getAccount();let s=e||"";if(!s)if(P.isHD()){const t=P.getDerivationPath().split("/").slice(0,4).join("/");s=await P.getMasterKey().getxpub(t)}else s=await P.getMasterKey().getCurrentAddress();const o=window.location.origin+window.location.pathname,i=r.Buffer.from(n.name).toString("hex");return`${o}?addcontact=${encodeURIComponent(i+":"+s)}`}(e,t);k.domModalQrLabel.innerHTML=`${rt.shareContactURL}<i onclick="MPW.localContactToClipboard(event)" id="guiAddressCopy" class="fas fa-clipboard" style="cursor: pointer; width: 20px;"></i>`,k.domModalQR.innerHTML=`\n                <p>${rt.onlyShareContactPrivately}</p>\n                <div id="receiveModalEmbeddedQR"></div>\n            `;const n=document.getElementById("receiveModalEmbeddedQR");yt(a,n,10),n.firstChild.style.width="100%",n.firstChild.style.height="auto",n.firstChild.classList.add("no-antialias"),document.getElementById("clipboard").value=t}else{const t=await P.getMasterKey().getCurrentAddress();k.domModalQrLabel.innerHTML=t+`<i onclick="MPW.toClipboard('${t}', this)" id="guiAddressCopy" class="fas fa-clipboard" style="cursor: pointer; width: 20px;"></i>`,await S()?k.domModalQR.innerHTML=`\n                    <center>\n                        <b>${rt.setupYourContact}</b>\n                        <p>${rt.receiveWithContact}</p>\n                        <input id="setContactName" placeholder="${rt.username}" style="text-align: center;"></input>\n                        <button onclick="MPW.guiSetAccountName('setContactName')">${rt.createContact}</button>\n                    </center>\n                `:k.domModalQR.innerHTML=`\n                    <center>\n                        <b>${rt.secureYourWallet}</b>\n                        <p>${st(rt.encryptFirstForContacts,[{button:rt.secureYourWallet}])}</p>\n                    </center>\n                `}}else if(t===O.ADDRESS){const t=await P.getMasterKey().getCurrentAddress();yt("pivx:"+t,k.domModalQR),k.domModalQrLabel.innerHTML=t+`<i onclick="MPW.toClipboard('${t}', this)" id="guiAddressCopy" class="fas fa-clipboard" style="cursor: pointer; width: 20px;"></i>`,k.domModalQR.firstChild.style.width="100%",k.domModalQR.firstChild.style.height="auto",k.domModalQR.firstChild.classList.add("no-antialias"),document.getElementById("clipboard").value=t}else{const t=P.getDerivationPath().split("/").slice(0,4).join("/"),e=await P.getMasterKey().getxpub(t);k.domModalQrLabel.innerHTML=e+`<i onclick="MPW.toClipboard('${e}', this)" id="guiAddressCopy" class="fas fa-clipboard" style="cursor: pointer; width: 20px;"></i>`,k.domModalQR.innerHTML=`\n            <p>${rt.onlyShareContactPrivately}</p>\n            <div id="receiveModalEmbeddedQR"></div>\n        `;const a=document.getElementById("receiveModalEmbeddedQR");yt(e,a,10),a.firstChild.style.width="100%",a.firstChild.style.height="auto",a.firstChild.classList.add("no-antialias"),document.getElementById("clipboard").value=e}}a(3006);const O={CONTACT:0,ADDRESS:1,XPUB:2};let C=O.CONTACT;a(25108),a(19755);const P=new class{#t;constructor(){}getMasterKey(){return this.#t}isViewOnly(){return!!this.#t&&this.#t.isViewOnly}isHD(){return!!this.#t&&this.#t.isHD}async hasWalletUnlocked(t=!1){return t&&!null.enabled?ut("warning",nt.WALLET_OFFLINE_AUTOMATIC,5500):!!this.isLoaded()||ut("warning",st(nt.WALLET_UNLOCK_IMPORT,[{unlock:await S()?"unlock ":"import/create"}]),3500)}async setMasterKey(t){this.#t=t,await null.setMasterKey(this.#t)}getDefaultAddress(){return this.#t.getAddress(this.#t.getDerivationPath())}isLoaded(){return!!this.#t}async encryptWallet(t=""){let e=await async function(t,e=""){const a=e||window.prompt("Please enter your wallet encryption password");return!!a&&await async function(t,e){try{const a=window.crypto.getRandomValues(new Uint8Array(16)),n=window.crypto.getRandomValues(new Uint8Array(12)),r=await T(e),s=await E(r,a,["encrypt"]),o=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:n},s,w.encode(t)),i=new Uint8Array(o);let c=new Uint8Array(a.byteLength+n.byteLength+i.byteLength);return c.set(a,0),c.set(n,a.byteLength),c.set(i,a.byteLength+n.byteLength),(t=>btoa(String.fromCharCode.apply(null,t)))(c)}catch(t){return f.log(`Error - ${t}`),""}}(t,a)}(this.#t.keyToBackup,t);if(!e)return!1;k.domGenKeyWarning.style.display="none";const a=new v({publicKey:await this.#t.keyToExport,encWif:e}),n=await at.getInstance();await n.getAccount()?await n.updateAccount(a):await n.addAccount(a),removeEventListener("beforeunload",H,{capture:!0})}async getNewAddress({updateGUI:t=!1,verify:e=!1}={}){const[a,n]=await this.#t.getNewAddress();if(e&&this.#t.isHardwareWallet&&a!==await ht({title:nt.CONFIRM_POPUP_VERIFY_ADDR,html:A(a),resolvePromise:this.#t.getAddress(n,{verify:e})}))throw new Error("User did not verify address");return t&&async function(){(async function(t=null){const e=P.isHD()?3:2;C=null!==t?t:(C+1)%e;let a="";switch((C+1)%e){case O.CONTACT:a=rt.contact;break;case O.ADDRESS:a=rt.address;break;case O.XPUB:a=rt.xpub}k.domModalQrReceiveTypeBtn.innerText=rt.changeTo+" "+a,b(C)})(C)}(),[a,n]}isHardwareWallet(){return!!this.#t&&1==this.#t.isHardwareWallet}async isOwnAddress(t){return await this.#t.isOwnAddress(t)}getDerivationPath(t=0,e=0,a=0){return this.#t.getDerivationPath(t,e,a)}};async function S(){const t=await at.getInstance();return!!(await t.getAccount())?.encWif}function A(t){return`${rt.popupHardwareAddrCheck} .\n              <div class="seed-phrase">${t}</div>`}a(51409);var M=a(77191),I=a.n(M);const R={0:0,FALSE:0,PUSHDATA1:76,PUSHDATA2:77,PUSHDATA4:78,"1NEGATE":79,RESERVED:80,1:81,TRUE:81,2:82,3:83,4:84,5:85,6:86,7:87,8:88,9:89,10:90,11:91,12:92,13:93,14:94,15:95,16:96,NOP:97,VER:98,IF:99,NOTIF:100,VERIF:101,VERNOTIF:102,ELSE:103,ENDIF:104,VERIFY:105,RETURN:106,TOALTSTACK:107,FROMALTSTACK:108,"2DROP":109,"2DUP":110,"3DUP":111,"2OVER":112,"2ROT":113,"2SWAP":114,IFDUP:115,DEPTH:116,DROP:117,DUP:118,NIP:119,OVER:120,PICK:121,ROLL:122,ROT:123,SWAP:124,TUCK:125,CAT:126,SUBSTR:127,LEFT:128,RIGHT:129,SIZE:130,INVERT:131,AND:132,OR:133,XOR:134,EQUAL:135,EQUALVERIFY:136,RESERVED1:137,RESERVED2:138,"1ADD":139,"1SUB":140,"2MUL":141,"2DIV":142,NEGATE:143,ABS:144,NOT:145,"0NOTEQUAL":146,ADD:147,SUB:148,MUL:149,DIV:150,MOD:151,LSHIFT:152,RSHIFT:153,BOOLAND:154,BOOLOR:155,NUMEQUAL:156,NUMEQUALVERIFY:157,NUMNOTEQUAL:158,LESSTHAN:159,GREATERTHAN:160,LESSTHANOREQUAL:161,GREATERTHANOREQUAL:162,MIN:163,MAX:164,WITHIN:165,RIPEMD160:166,SHA1:167,SHA256:168,HASH160:169,HASH256:170,CODESEPARATOR:171,CHECKSIG:172,CHECKSIGVERIFY:173,CHECKMULTISIG:174,CHECKMULTISIGVERIFY:175,NOP1:176,NOP2:177,CHECKLOCKTIMEVERIFY:177,NOP3:178,NOP4:179,NOP5:180,NOP6:181,NOP7:182,NOP8:183,NOP9:184,NOP10:185,ZEROCOINMINT:193,ZEROCOINSPEND:194,ZEROCOINPUBLICSPEND:195,CHECKCOLDSTAKEVERIFY_LOF:209,CHECKCOLDSTAKEVERIFY:210,INVALIDOPCODE:255};Object.freeze(R),a(25108);var x=a(25108);class D{cData={};strName="";strEndpoint="";async ensureCacheExists(){this.cData&&Object.keys(this.cData).length||await this.fetch()}async fetch(){try{return this.cData=await(await fetch(this.strEndpoint)).json()}catch(t){return x.warn("CoinGecko: Failed to fetch prices!"),x.warn(t),null}}}var U=a(91555);a(19755),a(25108);let k={};const L=new g;function _(){k.domGuiBalanceValueCurrency.innerText=$.toUpperCase(),k.domGuiStakingValueCurrency.innerText=$.toUpperCase(),k.domSendAmountValueCurrency.innerText=$.toUpperCase(),k.domSendAmountCoinsTicker.innerText=u.current.TICKER,k.domStakeAmountValueCurrency.innerText=$.toUpperCase(),k.domStakeAmountCoinsTicker.innerText=u.current.TICKER,k.domUnstakeAmountValueCurrency.innerText=$.toUpperCase(),k.domUnstakeAmountCoinsTicker.innerText=u.current.TICKER}async function B(t,e=!1){const a=await j.getPrice($);if(a){const n=(e?N():K())/d*a,{nValue:r,cLocale:s}=function(t){let e=t;const a=Intl.supportedValuesOf("currency").includes($.toUpperCase())?{style:"currency",currency:$,currencyDisplay:"narrowSymbol"}:{maximumFractionDigits:8,minimumFractionDigits:8};return"sats"===$&&(e=Math.round(e),a.maximumFractionDigits=0,a.minimumFractionDigits=0),{nValue:e,cLocale:a}}(n);t.innerText=r.toLocaleString("en-gb",s)}}function K(t=!1){const e=L.getBalance();if(t){const t=(e/d).toFixed(G),a=t.length;k.domGuiBalance.innerHTML=mt(t,a>=10?"17px":"25px"),k.domAvailToDelegate.innerHTML=mt(t)+" "+u.current.TICKER,_(),B(k.domGuiBalanceValue)}return e}function N(t=!1){const e=L.getDelegatedBalance();if(t){const t=(e/d).toFixed(G),a=t.length;k.domGuiBalanceStaking.innerHTML=mt(t,a>=10?"17px":"25px"),k.domAvailToUndelegate.innerHTML=mt(t)+" "+u.current.TICKER,_(),B(k.domGuiStakingValue,!0)}return e}u.current.isTestnet;const H=t=>(t.preventDefault(),ut("warning",nt.SAVE_WALLET_PLEASE,1e4),t.returnValue=rt.BACKUP_OR_ENCRYPT_WALLET);function V(t){const e=`${rt.unhandledException} <br> ${pt(t.message||t.reason)}`;try{ut("warning",e)}catch(t){alert(e)}}try{window.addEventListener("error",V),window.addEventListener("unhandledrejection",V)}catch(t){}let X=!1,$="usd",j=new class extends D{constructor(){super(),this.strName="CoinGecko",this.strEndpoint="https://api.coingecko.com/api/v3/coins/pivx?localization=false&tickers=false&market_data=true&community_data=false&developer_data=false&sparkline=false"}async getPrice(t){return await this.ensureCacheExists(),this.cData?.market_data?.current_price[t]||0}async getCurrencies(){return await this.ensureCacheExists(),ft(this.cData)?[]:Object.keys(this.cData.market_data.current_price)}},F=u.current.Explorers[0],W=u.current.Nodes[0],G=2;class Y{analytics;explorer;node;autoswitch;coldAddress;translation;displayCurrency;displayDecimals;advancedMode;constructor({analytics:t,explorer:e,node:a,autoswitch:n=!0,coldAddress:r="SdgQDpS8jDRJDX8yK8m9KnTMarsE84zdsy",translation:s="",displayCurrency:o="usd",displayDecimals:i=G,advancedMode:c=!1}={}){this.analytics=t,this.explorer=e,this.node=a,this.autoswitch=n,this.coldAddress=r,this.translation=s,this.displayCurrency=o,this.displayDecimals=i,this.advancedMode=c}}let Q={hit:"A ping indicating an app load, no unique data is sent.",time_to_sync:"The time in seconds it took for MPW to last synchronise.",transaction:"A ping indicating a Tx, no unique data is sent, but may be inferred from on-chain time."};Object.keys(Q);var z=a(60743),q=a.n(z),J=a(25108);class Z{constructor({walletPrivateKeyPath:t,mnPrivateKey:e,collateralTxId:a,outidx:n,addr:r}={}){this.walletPrivateKeyPath=t,this.mnPrivateKey=e,this.collateralTxId=a,this.outidx=n,this.addr=r}static sessionVotes=[];async _getWalletPrivateKey(){return await P.getMasterKey().getPrivateKey(this.walletPrivateKeyPath)}async getFullData(){const t=`${W.url}/listmasternodes?params=${this.collateralTxId}`;try{const e=(await(await fetch(t)).json()).filter((t=>t.outidx===this.outidx));return e.length>0?e[0]:{status:"MISSING"}}catch(t){return J.error(t),"EXPLORER_DOWN"}}async getStatus(){const t=await this.getFullData();return t?t.status:"MISSING"}static _decodeIpAddress(t,e){let a;if(t.endsWith(".onion")){const e=q().decode(t.slice(0,-6)).split("").map((t=>t.charCodeAt(0)));switch(e.length){case 10:a=[253,135,216,126,235,67,...e];break;case 35:a=[4,32,...e.slice(0,32)];break;default:throw new Error("Invalid onion address")}}else a=(t.includes(".")?U.S5.fromAddress4(t):new U.S5(t)).toUnsignedByteArray();return o([...new Array(Math.max(16-a.length,0)).fill(0),...a])+o(Z._numToBytes(e,2,!1))}static _numToBytes(t,e=8,a=!0){const n=[];for(let a=0;a<e;a++)n.push(t/2**(8*a)&255);return a?n:n.reverse()}static getPingSignature({vin:t,blockHash:e,sigTime:a}){return i([...s(t.txid).reverse(),...Z._numToBytes(t.idx,4,!0),0,255,255,255,255,...s(e).reverse(),...Z._numToBytes(a,8,!0)])}static getToSign({publicKey:t,addr:e,mnPrivateKey:a,sigTime:n}){let r,c;e.includes(".")?[r,c]=e.split(":"):([r,c]=e.slice(1).split("]"),c=c.slice(1));const l=s(wt({pkBytes:Tt(a,!0),output:"UNCOMPRESSED_HEX"}));return o(i([...Z._numToBytes(1,4,!0),...s(Z._decodeIpAddress(r,c)),...Z._numToBytes(n,8,!0),...Z._numToBytes(t.length,1,!0),...t,...Z._numToBytes(l.length,1,!0),...l,...Z._numToBytes(u.current.PROTOCOL_VERSION,4,!0)]).reverse())}static async getLastBlockHash(){return(await(await fetch(`${F.url}/api/`)).json()).backend.bestBlockHash}async getSignedMessage(t){const e=Z.getToSign({addr:this.addr,publicKey:await this.getWalletPublicKey(),mnPrivateKey:this.mnPrivateKey,sigTime:t});if(P.isHardwareWallet()){const{r:t,s:a,v:n}=await null.signMessage(this.walletPrivateKeyPath,o(e));return[n+31,...s(t),...s(a)]}{const t="DarkNet Signed Message:\n".split("").map((t=>t.charCodeAt(0))),a=await this._getWalletPrivateKey(),n=e.split("").map((t=>t.charCodeAt(0))),r=i(t.concat(n.length).concat(n)),[s,o]=await c.Xx(r,Tt(a,!0),{der:!1,recovered:!0});return[o+31,...s]}}async getSignedPingMessage(t,e){const a=Z.getPingSignature({vin:{txid:this.collateralTxId,idx:this.outidx},blockHash:e,sigTime:t}),[n,r]=await c.Xx(a,Tt(this.mnPrivateKey,!0),{der:!1,recovered:!0});return[r+27,...n]}async getWalletPublicKey(){return P.isHardwareWallet()?s(await P.getMasterKey().getPublicKey(this.walletPrivateKeyPath)):s(wt({pkBytes:Tt(await this._getWalletPrivateKey(),!0),output:"COMPRESSED_HEX"}))}async broadcastMessageToHex(){const t=Math.round(Date.now()/1e3),e=await Z.getLastBlockHash();let a,n;this.addr.includes(".")?[a,n]=this.addr.split(":"):([a,n]=this.addr.slice(1).split("]"),n=n.slice(1));const r=await this.getWalletPublicKey(),i=s(wt({pkBytes:Tt(this.mnPrivateKey,!0),output:"UNCOMPRESSED_HEX",compress:!1})),c=await this.getSignedMessage(t),l=await this.getSignedPingMessage(t,e);return o([...s(this.collateralTxId).reverse(),...Z._numToBytes(this.outidx,4,!0),...Z._numToBytes(0,1,!0),...Z._numToBytes(4294967295,4,!0),...s(Z._decodeIpAddress(a,n)),...Z._numToBytes(r.length,1,!0),...r,...Z._numToBytes(i.length,1,!0),...i,...Z._numToBytes(c.length,1,!0),...c,...Z._numToBytes(t,8,!0),...Z._numToBytes(u.current.PROTOCOL_VERSION,4,!0),...s(this.collateralTxId).reverse(),...Z._numToBytes(this.outidx,4,!0),...Z._numToBytes(0,1,!0),...Z._numToBytes(4294967295,4,!0),...s(e).reverse(),...Z._numToBytes(t,8,!0),...Z._numToBytes(l.length,1,!0),...l,...Z._numToBytes(1,4,!0),...Z._numToBytes(1,4,!0)])}async start(){const t=await this.broadcastMessageToHex(),e=`${W.url}/relaymasternodebroadcast?params=${t}`;return(await(await fetch(e)).text()).includes("Masternode broadcast sent")}static async getProposals({fAllowFinished:t=!1}={}){const e=`${W.url}/getbudgetinfo`;let a=await(await fetch(e)).json();return t||(a=a.filter((t=>t.RemainingPaymentCount>0))),a}async getSignedVoteMessage(t,e,a){const n=[...s(this.collateralTxId).reverse(),...Z._numToBytes(this.outidx,4,!0),0,255,255,255,255,...s(t).reverse(),...Z._numToBytes(e,4,!0),...Z._numToBytes(a,8,!0)],[o,l]=await c.Xx(i(n),Tt(this.mnPrivateKey,!0),{der:!1,recovered:!0});return r.Buffer.from([l+27,...o]).toString("base64")}async getVote(t,e){const a=Z.sessionVotes.findIndex((([t])=>t===e));if(-1!==a)return Z.sessionVotes[a][1];const n=`${encodeURI('.[] | select(.mnId=="')}${this.collateralTxId}-${this.outidx}")`,r=`${W.url}/getbudgetvotes?params=${t}&filter=${n}`;try{const{Vote:t}=await(await fetch(r)).json();return"YES"===t?1:2}catch(t){return null}}storeVote(t,e){const a=[t,e],n=Z.sessionVotes.findIndex((([e])=>e===t));-1!==n?Z.sessionVotes[n]=a:Z.sessionVotes.push(a)}async vote(t,e){const a=Math.round(Date.now()/1e3),n=await this.getSignedVoteMessage(t,e,a),r=`${W.url}/mnbudgetrawvote?params=${this.collateralTxId},${this.outidx},${t},${1===e?"yes":"no"},${a},${encodeURI(n).replaceAll("+","%2b")}`;return await(await fetch(r)).text()}static createProposalHash({name:t,url:e,nPayments:a,start:n,address:r,monthlyPayment:s}){const c=n+(u.current.budgetCycleBlocks+1)*a,l=I().decode(r),d=[R.DUP,R.HASH160,l.length-5,...l.slice(1,l.length-4),R.EQUALVERIFY,R.CHECKSIG],h=[t.length,...t.split("").map((t=>t.charCodeAt(0))),e.length,...e.split("").map((t=>t.charCodeAt(0))),...Z._numToBytes(n,4,!0),...Z._numToBytes(c,4,!0),...Z._numToBytes(s,8,!0),d.length,...d];return o(i(new Uint8Array(h)))}static async finalizeProposal({name:t,url:e,nPayments:a,start:n,address:r,monthlyPayment:s,txid:o}){try{const i=await(await fetch(`${W.url}/submitbudget?params=${encodeURI(t)},${encodeURI(e)},${a},${n},${encodeURI(r)},${s/d},${o}`)).text();return 66==i.length?{ok:!0,hash:i}:i.includes("is unconfirmed")||i.includes("requires at least")?{ok:!1,err:"unconfirmed"}:i.includes("invalid budget proposal")||i.includes("Invalid block start")?{ok:!1,err:"invalid"}:{ok:!1,err:"other"}}catch(t){return J.error(t),{ok:!1,err:t}}}static async getNextSuperblock(){return parseInt(await(await fetch(`${W.url}/getnextsuperblock`)).text())}static async getMasternodeCount(){return await(await fetch(`${W.url}/getmasternodecount`)).json()}static isValidProposal({name:t,url:e,nPayments:a,_start:n,_address:r,monthlyPayment:s}){const o=/^[a-z0-9 .,;\-_/:?@()]+$/i;return t.length>20?{ok:!1,err:"name_length"}:o.test(t)?e.length>64?{ok:!1,err:"url_length"}:o.test(e)&&/^(https?):\/\/[^\s/$.?#][^\s]*[^\s/.]\.[^\s/.][^\s]*[^\s.]$/.test(e)?a<1||a>u.current.maxPaymentCycles?{ok:!1,err:"invalid_payment_count"}:s<1e9||s*a>u.current.maxPayment?{ok:!1,err:"invalid_monthly_payment"}:{ok:!0}:{ok:!1,err:"invalid_url"}:{ok:!1,err:"invalid_name"}}}a(19755);class tt{constructor({code:t,address:e,pkBytes:a,utxos:n,time:r}){this.code=t,this.address=e,this.pkBytes=a,this.utxos=n,this.time=r instanceof Date?r:new Date(r)}fSynced=!1;fLock=!1;async getBalance(t=!1){return t||await this.getUTXOs(),this.utxos.reduce(((t,e)=>t+e.sats),0)}async getUTXOs(t=!1){if(!t&&this.fLock)return this.utxos;this.fLock=!0,this.address||(this.address=wt({pkBytes:this.pkBytes}));const e=await null.getUTXOs(this.address);this.utxos=[];for(const a of e)t?this.utxos.push(await null.getUTXOFullInfo(a)):this.utxos.push({id:a.txid,sats:parseInt(a.value),vout:a.vout});return this.fLock=!1,this.fSynced=!0,this.utxos}}var et=a(25108);class at{static version=1;#e;constructor({db:t}){this.#e=t}close(){this.#e.close(),this.#e=null}async addMasternode(t,e){const a=this.#e.transaction("masternodes","readwrite").objectStore("masternodes");await a.put(t,"masternode")}async removeMasternode(t){const e=this.#e.transaction("masternodes","readwrite").objectStore("masternodes");await e.delete("masternode")}async addPromo(t){const e=this.#e.transaction("promos","readwrite").objectStore("promos");await e.put(t,t.code)}async removePromo(t){const e=this.#e.transaction("promos","readwrite").objectStore("promos");await e.delete(t)}async addAccount(t){if(!(t instanceof v))return et.error("---- addAccount() called with invalid input, input dump below ----"),et.error(t),et.error("---- end of account dump ----"),ut("warning","<b>Account Creation Error</b><br>Logs were dumped in your Browser Console<br>Please submit these privately to PIVX Labs Developers!"),!1;const e=new v;for(const a of Object.keys(e))gt(t[a],e[a])?e[a]=t[a]:et.error('DB: addAccount() key "'+a+'" does NOT match the correct class type, likely data mismatch, please report!');const a=this.#e.transaction("accounts","readwrite").objectStore("accounts");if(await a.get("account"))return et.error("DB: Ran addAccount() when account already exists!");await a.put(e,"account")}async updateAccount(t,e=!1){if(!(t instanceof v))return et.error("---- updateAccount() called with invalid input, input dump below ----"),et.error(t),et.error("---- end of account dump ----"),ut("warning","<b>DB Update Error</b><br>Your wallet is safe, logs were dumped in your Browser Console<br>Please submit these privately to PIVX Labs Developers!"),!1;const a=await this.getAccount();if(!a)return et.error("---- updateAccount() called without an account existing, input dump below ----"),et.error(t),et.error("---- end of input dump ----"),ut("warning","<b>DB Update Error</b><br>Logs were dumped in your Browser Console<br>Please submit these privately to PIVX Labs Developers!"),!1;for(const n of Object.keys(a))gt(t[n],a[n])?!e&&ft(t[n])||(a[n]=t[n]):et.error('DB: updateAccount() key "'+n+'" does NOT match the correct class type, likely data mismatch, please report!');const n=this.#e.transaction("accounts","readwrite").objectStore("accounts");await n.put(a,"account")}async removeAccount({publicKey:t}){const e=this.#e.transaction("accounts","readwrite").objectStore("accounts");await e.delete("account")}async getAccount(){const t=this.#e.transaction("accounts","readonly").objectStore("accounts"),e=await t.get("account");if(!e)return null;const a=new v;for(const t of Object.keys(a))Object.prototype.hasOwnProperty.call(e,t)&&(gt(e[t],a[t])?a[t]=e[t]:et.error('DB: getAccount() key "'+t+'" does NOT match the correct class type, likely bad data saved, please report!'));return a}async getMasternode(t){const e=this.#e.transaction("masternodes","readonly").objectStore("masternodes");return new Z(await e.get("masternode"))}async getAllPromos(){const t=this.#e.transaction("promos","readonly").objectStore("promos");return(await t.getAll()).map((t=>new tt(t)))}async getSettings(){const t=this.#e.transaction("settings","readonly").objectStore("settings");return new Y(await t.get("settings"))}async setSettings(t){const e=await this.getSettings(),a=this.#e.transaction("settings","readwrite").objectStore("settings");await a.put({...e,...t},"settings")}async#a(){if(0===localStorage.length)return;const t=new Y({analytics:localStorage.analytics,explorer:localStorage.explorer,node:localStorage.node,translation:localStorage.translation,displayCurrency:localStorage.displayCurrency});if(await this.setSettings(t),localStorage.masternode)try{const t=JSON.parse(localStorage.masternode);await this.addMasternode(t)}catch(t){et.error(t),ut("warning",nt.MIGRATION_MASTERNODE_FAILURE)}if(localStorage.encwif||localStorage.publicKey)try{const t=JSON.parse(localStorage.localProposals||"[]"),e=new v({publicKey:localStorage.publicKey,encWif:localStorage.encwif,localProposals:t});await this.addAccount(e)}catch(t){et.error(t),ut("warning",nt.MIGRATION_ACCOUNT_FAILURE),localStorage.encwif&&await ht({title:rt.MIGRATION_ACCOUNT_FAILURE_TITLE,html:`${rt.MIGRATION_ACCOUNT_FAILURE_HTML} <code id="exportPrivateKeyText">${pt(localStorage.encwif)} </code>`})}}static async create(t){let e=!1;const a=new at({db:null}),n=await(0,h.X3)(`MPW-${t}`,2,{upgrade:(t,a)=>{et.log("DB: Upgrading from "+a+" to 2"),0==a&&(t.createObjectStore("masternodes"),t.createObjectStore("accounts"),t.createObjectStore("settings"),e=!0),a<=1&&t.createObjectStore("promos")},blocking:()=>{a.close(),alert("New update received!"),window.location.reload()}});return a.#e=n,e&&a.#a(),a}static#n=new Map;static async getInstance(){const t=u.current.name,e=this.#n.get(t);return e&&e.#e||this.#n.set(t,await at.create(t)),this.#n.get(t)}}a(25108);const nt={};let rt={};function st(t,e){return e.forEach((e=>{t=t.replaceAll("{"+Object.keys(e)[0]+"}",Object.values(e)[0])})),t}var ot=a(96192),it=a.n(ot),ct=(a(27715),a(19755));function lt(t=32){return crypto.getRandomValues(new Uint8Array(t))}function dt(t,e,a){const n=t.length;if(n-a-e.length<0){const t="CRITICAL: Overflow detected ("+(n-a-e.length)+"), possible state corruption, backup and refresh advised.";throw ut("warning",t,5e3),Error(t)}let r=0;for(;a<n;)t[a++]=e[r++]}function ut(t,e,a=0){const n=document.createElement("div");let r;switch(n.classList.add("notifyWrapper"),n.classList.add(t),setTimeout((()=>{n.style.opacity="1",n.style.zIndex="999999",n.classList.add("bounce-ani"),n.classList.add("bounce")}),100),t){case"warning":r="fa-exclamation";break;case"info":r="fa-info";break;default:r="fa-check"}n.innerHTML=`\n    <div class="notifyIcon notify-${t}">\n        <i class="fas ${r} fa-xl"></i>\n    </div>\n    <div class="notifyText">\n        ${e}\n    </div>`,n.destroy=()=>{clearTimeout(n.timer),n.style.opacity="0",setTimeout((()=>{n.remove()}),600)},n.addEventListener("click",n.destroy),a>0&&(n.timer=setTimeout(n.destroy,a)),k.domAlertPos.appendChild(n)}async function ht({title:t,html:e,resolvePromise:a,hideConfirm:n,purpleModal:r,textLeft:s,noPadding:o,maxHeight:i}){k.domConfirmModalHeader.style.display=t?"block":"none",k.domConfirmModalTitle.innerHTML=t||"",k.domConfirmModalButtons.style.setProperty("display",a?"none":"block",a?"important":void 0),ct("#confirmModal").modal(a?"show":{keyboard:!1}),k.domConfirmModalConfirmButton.style.display=n?"none":"",k.domConfirmModalCancelButton.innerText=n?rt.popupClose:rt.popupCancel,k.domConfirmModalContent.innerHTML=e,s?k.domConfirmModalContent.classList.remove("center-text"):k.domConfirmModalContent.classList.add("center-text"),r?k.domConfirmModalMain.classList.add("exportKeysModalColor"):k.domConfirmModalMain.classList.remove("exportKeysModalColor"),o?(k.domConfirmModalContent.classList.add("px-0"),k.domConfirmModalContent.classList.add("pb-0")):(k.domConfirmModalContent.classList.remove("px-0"),k.domConfirmModalContent.classList.remove("pb-0")),i&&k.domConfirmModalDialog.classList.add(`max-w-${i}`);for(const t of k.domConfirmModalContent.children)if("text"===t.type||"password"===t.type){t.focus();break}a=a||new Promise(((t,e)=>{k.domConfirmModalConfirmButton.onclick=()=>{t(!0)},k.domConfirmModalCancelButton.onclick=()=>{t(!1)}}));try{return await a}finally{ct("#confirmModal").modal("hide"),k.domConfirmModalDialog.classList.remove(`max-w-${i}`)}}function yt(t="",e,a=4){const n=it()(a,"L");n.addData(t),n.make(),e.innerHTML=n.createImgTag(2,2),e.firstChild.style.borderRadius="8px"}function pt(t){const e=document.createElement("div");return e.innerText=t,e.innerHTML}function mt(t,e=""){if("number"==typeof t&&(t=t.toString()),!t.includes("."))return t;const a=t.split("."),n=e?"font-size: "+e:"";return`${a[0]}<span style="opacity: 0.55; ${n}">.${a[1]}</span>`}function gt(t,e){try{return null===t||null===e?t===e:typeof t==typeof e&&("object"!=typeof t||Object.getPrototypeOf(t)===Object.getPrototypeOf(e))}catch(t){return!1}}function ft(t){return null==t||""===t||Array.isArray(t)&&0===t.length||"object"==typeof t&&0===Object.keys(t).length}function wt({pkBytes:t,publicKey:e,output:a="ENCODED"}){if(!t&&!e)return null;const r="UNCOMPRESSED_HEX"!==a;let d=e?s(e):c.$3(t,r);if("UNCOMPRESSED_HEX"===a){if(65!==d.length)throw new Error("Can't uncompress an already compressed key");return o(d)}if(65===d.length&&(d=function(t){if(65!=t.length)throw new Error("Attempting to compress an invalid uncompressed key");const e=t.slice(1,33);return[t.slice(33)[31]%2==0?2:3,...e]}(d)),33!=d.length)throw new Error("Invalid public key");if("COMPRESSED_HEX"===a)return o(d);const h=(0,n.J)(new Uint8Array(d)),y=(0,l.b)(h),p=new Uint8Array(21);p[0]=u.current.PUBKEY_ADDRESS,dt(p,y,1);const m=i(p).slice(0,4),g=new Uint8Array(25);return dt(g,p,0),dt(g,m,21),I().encode(g)}function Tt(t,e=!1){return function(t="",e=!1,a=!1){const n=I().decode(t);if(!a){if(38!==n.byteLength)throw Error("Private key length ("+n.byteLength+") is invalid, should be 38!");if(n[0]!==u.current.SECRET_KEY){const t=Object.keys(u).filter((t=>"current"!==t)).map((t=>u[t])).find((t=>t.SECRET_KEY===n[0]));throw Error(t?"This private key is for "+(t.isTestnet?"Testnet":"Mainnet")+", wrong network!":"This private key belongs to another coin, or is corrupted.")}const t=i(n.slice(0,34)),e=n.slice(n.byteLength-4),a=t.slice(0,4);if(e.join("")!==a.join(""))throw Error("Private key checksum is invalid, key may be modified, mis-typed, or corrupt.")}return!e||Uint8Array.from(n.slice(1,33))}(t,!0,e)}onmessage=function(t){for(;;){const t={};t.priv=lt(),t.pub=wt({pkBytes:t.priv}),postMessage(t)}}},95856:()=>{},48777:()=>{},46601:()=>{},89214:()=>{},52361:()=>{},94616:()=>{}},s={};function o(t){var e=s[t];if(void 0!==e)return e.exports;var a=s[t]={id:t,loaded:!1,exports:{}};return r[t].call(a.exports,a,a.exports,o),a.loaded=!0,a.exports}o.m=r,o.x=()=>{var t=o.O(void 0,[621,369],(()=>o(32896)));return o.O(t)},t=[],o.O=(e,a,n,r)=>{if(!a){var s=1/0;for(d=0;d<t.length;d++){for(var[a,n,r]=t[d],i=!0,c=0;c<a.length;c++)(!1&r||s>=r)&&Object.keys(o.O).every((t=>o.O[t](a[c])))?a.splice(c--,1):(i=!1,r<s&&(s=r));if(i){t.splice(d--,1);var l=n();void 0!==l&&(e=l)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[a,n,r]},o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},a=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,o.t=function(t,n){if(1&n&&(t=this(t)),8&n)return t;if("object"==typeof t&&t){if(4&n&&t.__esModule)return t;if(16&n&&"function"==typeof t.then)return t}var r=Object.create(null);o.r(r);var s={};e=e||[null,a({}),a([]),a(a)];for(var i=2&n&&t;"object"==typeof i&&!~e.indexOf(i);i=a(i))Object.getOwnPropertyNames(i).forEach((e=>s[e]=()=>t[e]));return s.default=()=>t,o.d(r,s),r},o.d=(t,e)=>{for(var a in e)o.o(e,a)&&!o.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce(((e,a)=>(o.f[a](t,e),e)),[])),o.u=t=>"./"+t+".mpw.js",o.miniCssF=t=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var a=e.getElementsByTagName("script");a.length&&(t=a[a.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),(()=>{o.b=self.location+"";var t={951:1};o.f.i=(e,a)=>{t[e]||importScripts(o.p+o.u(e))};var e=self.webpackChunkMPW=self.webpackChunkMPW||[],a=e.push.bind(e);e.push=e=>{var[n,r,s]=e;for(var i in r)o.o(r,i)&&(o.m[i]=r[i]);for(s&&s(o);n.length;)t[n.pop()]=1;a(e)}})(),n=o.x,o.x=()=>Promise.all([o.e(621),o.e(369)]).then(n);var i=o.x();MPW=i})();
//# sourceMappingURL=951.mpw.js.map